<!-- FreshCart Header - Following PrimeNG + Tailwind Best Practices -->

<!-- Desktop Header: PrimeNG MenuBar (hidden on mobile) -->
<p-menubar 
  [model]="menuItems()" 
  styleClass="shadow-md border-b border-surface !hidden md:!flex">
  
  <!-- Brand/Logo -->
  <ng-template pTemplate="start">
    <a 
      [routerLink]="['/']" 
      class="flex items-center gap-2 cursor-pointer no-underline hover:opacity-90 transition-opacity"
      [attr.aria-label]="'Navigate to FreshCart homepage'">
      <i class="pi pi-shopping-cart text-2xl text-primary"></i>
      <span class="text-xl font-bold text-color">FreshCart</span>
    </a>
  </ng-template>
    
  <!-- Desktop Actions Section -->
  <ng-template pTemplate="end">
    <div class="flex items-center gap-1">
      
      <!-- Wishlist Button with Badge -->
      <p-button 
        icon="pi pi-heart"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        [badge]="wishlistBadgeCount() ? wishlistBadgeCount().toString() : undefined"
        badgeSeverity="danger"
        routerLink="/wishlist"
        [attr.aria-label]="'NAVIGATION.WISHLIST' | translate"
        [pTooltip]="'NAVIGATION.WISHLIST' | translate"
        tooltipPosition="bottom">
      </p-button>
      
      <!-- Cart Button with Badge -->
      <p-button 
        icon="pi pi-shopping-cart"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        [badge]="cartBadgeCount() ? cartBadgeCount().toString() : undefined"
        badgeSeverity="success"
        routerLink="/cart"
        [attr.aria-label]="'NAVIGATION.CART' | translate"
        [pTooltip]="'NAVIGATION.CART' | translate"
        tooltipPosition="bottom">
      </p-button>
      
      <!-- Theme Preset Selector (Icon Button with Popup Menu) -->
      <p-button 
        icon="pi pi-palette"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        (click)="themePresetMenu.toggle($event)"
        [attr.aria-label]="'Change theme: ' + currentPresetConfig().name"
        pTooltip="Change Theme"
        tooltipPosition="bottom">
      </p-button>
      
      <!-- Theme Preset Menu (Popup) -->
      <p-menu 
        #themePresetMenu
        [model]="themePresetMenuItems()"
        [popup]="true"
        appendTo="body"
        styleClass="theme-selector-menu">
        <ng-template pTemplate="item" let-item>
          <div class="flex items-center gap-3 p-2 w-64">
            <i [class]="item.icon" class="text-2xl text-primary"></i>
            <div class="flex flex-col flex-1">
              <span class="font-semibold text-sm">{{ item.label }}</span>
              <span class="text-xs text-muted-color">{{ getPresetDescription(item.label) }}</span>
            </div>
            @if (isCurrentTheme(item.label)) {
              <i class="pi pi-check text-primary"></i>
            }
          </div>
        </ng-template>
      </p-menu>
      
      <!-- Theme Toggle Button (Dark/Light) -->
      <p-button 
        [icon]="isDarkMode() ? 'pi pi-sun' : 'pi pi-moon'"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        (click)="toggleTheme()"
        [attr.aria-label]="'Toggle theme to ' + (isDarkMode() ? 'light' : 'dark') + ' mode'">
      </p-button>
      
      <!-- Language Toggle Button -->
      <p-button 
        [label]="currentLanguage() === 'en' ? 'العربية' : 'English'" 
        [icon]="'pi pi-globe'"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        (click)="toggleLanguage()"
        [attr.aria-label]="'Toggle language to ' + (currentLanguage() === 'en' ? 'Arabic' : 'English')">
      </p-button>
      
      <!-- Authentication Buttons -->
      @if (isAuthenticated()) {
        <!-- Authenticated User Dropdown -->
        <p-button 
          [icon]="'pi pi-user'"
          severity="primary" 
          [text]="true"
          [rounded]="true"
          [label]="currentUserName() || 'User'"
          (click)="userMenu.toggle($event)">
        </p-button>
        
        <!-- User Dropdown Menu -->
        <p-menu 
          #userMenu
          [model]="userMenuItems()"
          [popup]="true"
          styleClass="user-dropdown-menu">
        </p-menu>
      } @else {
        <!-- Guest User Actions -->
        <p-button 
          [icon]="'pi pi-sign-in'"
          severity="primary" 
          [text]="true"
          [rounded]="true"
          [label]="'AUTH.HEADER_LOGIN' | translate"
          (click)="navigateToLogin()"
          [attr.aria-label]="'AUTH.ARIA_LOGIN' | translate">
        </p-button>
        
        <p-button 
          [icon]="'pi pi-user-plus'"
          severity="primary" 
          [text]="true"
          [rounded]="true"
          [label]="'AUTH.HEADER_REGISTER' | translate"
          (click)="navigateToRegister()"
          [attr.aria-label]="'AUTH.ARIA_REGISTER' | translate">
        </p-button>
      }
      
    </div>
  </ng-template>
</p-menubar>

<!-- Mobile Header: Simple Toolbar (shown on mobile only) -->
<p-toolbar styleClass="shadow-md border-b border-surface md:!hidden">
  
  <!-- Mobile: Brand/Logo -->
  <ng-template pTemplate="start">
    <a 
      [routerLink]="['/']" 
      class="flex items-center gap-2 cursor-pointer no-underline hover:opacity-90 transition-opacity"
      [attr.aria-label]="'Navigate to FreshCart homepage'">
      <i class="pi pi-shopping-cart text-2xl text-primary"></i>
      <span class="text-xl font-bold text-color">FreshCart</span>
    </a>
  </ng-template>
  
  <!-- Mobile: Actions -->
  <ng-template pTemplate="end">
    <div class="flex items-center gap-1">
      
      <!-- Theme Preset Selector (Mobile) -->
      <p-button 
        icon="pi pi-palette"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        (click)="themePresetMenuMobile.toggle($event)"
        [attr.aria-label]="'Change theme: ' + currentPresetConfig().name">
      </p-button>
      
      <!-- Theme Preset Menu (Mobile) -->
      <p-menu 
        #themePresetMenuMobile
        [model]="themePresetMenuItems()"
        [popup]="true"
        appendTo="body"
        styleClass="theme-selector-menu">
        <ng-template pTemplate="item" let-item>
          <div class="flex items-center gap-3 p-2 w-64">
            <i [class]="item.icon" class="text-2xl text-primary"></i>
            <div class="flex flex-col flex-1">
              <span class="font-semibold text-sm">{{ item.label }}</span>
              <span class="text-xs text-muted-color">{{ getPresetDescription(item.label) }}</span>
            </div>
            @if (isCurrentTheme(item.label)) {
              <i class="pi pi-check text-primary"></i>
            }
          </div>
        </ng-template>
      </p-menu>
      
      <!-- Theme Toggle Button (Dark/Light) -->
      <p-button 
        [icon]="isDarkMode() ? 'pi pi-sun' : 'pi pi-moon'"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        (click)="toggleTheme()"
        [attr.aria-label]="'Toggle theme to ' + (isDarkMode() ? 'light' : 'dark') + ' mode'">
      </p-button>
      
      <!-- Language Toggle Button -->
      <p-button 
        [label]="currentLanguage() === 'en' ? 'ع' : 'En'" 
        severity="secondary"
        [text]="true"
        [rounded]="true"
        (click)="toggleLanguage()"
        [attr.aria-label]="'Toggle language to ' + (currentLanguage() === 'en' ? 'Arabic' : 'English')">
      </p-button>
      
      <!-- Hamburger Menu Button -->
      <p-button 
        icon="pi pi-bars"
        severity="secondary"
        [text]="true"
        [rounded]="true"
        (click)="openDrawer()"
        [attr.aria-label]="'Open navigation menu'"
        [attr.aria-controls]="'mobile-nav-drawer'"
        [attr.aria-expanded]="drawerVisible()">
      </p-button>
      
    </div>
  </ng-template>
  
</p-toolbar>

<!-- Mobile Navigation Drawer -->
<p-drawer 
  [(visible)]="drawerVisible"
  position="right"
  id="mobile-nav-drawer"
  styleClass="!w-80"
  [modal]="true">
  
  <ng-template #header>
    <div class="flex items-center gap-3">
      <i class="pi pi-shopping-cart text-2xl text-primary"></i>
      <span class="text-xl font-bold text-color">FreshCart</span>
    </div>
  </ng-template>
  
  <div class="flex flex-col h-full">
    
    <!-- User Profile Section (Authenticated Users) -->
    @if (isAuthenticated()) {
      <div class="pb-4 mb-4 border-b border-surface">
        <a
          [routerLink]="['/profile']"
          (click)="closeDrawer()"
          class="flex items-center gap-3 p-4 cursor-pointer hover:bg-emphasis rounded-lg transition-colors no-underline">
          <p-avatar 
            icon="pi pi-user" 
            shape="circle"
            size="large"
            styleClass="bg-primary text-primary-contrast" />
          <div class="flex-1">
            <div class="font-semibold text-color">{{ currentUserName() }}</div>
            <div class="text-sm text-muted-color">{{ 'NAVIGATION.VIEW_PROFILE' | translate }}</div>
          </div>
        </a>
      </div>
    }
    
    <!-- Navigation Menu Items -->
    <div class="flex-1 overflow-y-auto">
      <ul class="list-none p-0 m-0">
        @for (item of mobileMenuItems(); track item.label) {
          <li>
            <a 
              [routerLink]="item.routerLink"
              (click)="closeDrawer()"
              pRipple
              class="flex items-center gap-3 p-4 cursor-pointer text-color hover:bg-emphasis rounded-lg transition-colors no-underline">
              <i [class]="item.icon" class="text-lg"></i>
              <span class="font-medium flex-1">{{ item.label }}</span>
              @if (item.badge) {
                <span class="inline-flex items-center justify-center bg-primary text-primary-contrast rounded-full px-2 py-1 text-xs font-semibold min-w-[1.5rem]">
                  {{ item.badge }}
                </span>
              }
            </a>
          </li>
        }
      </ul>
      
      <!-- Authenticated User Menu Items -->
      @if (isAuthenticated()) {
        <div class="border-t border-surface mt-4 pt-4">
          <ul class="list-none p-0 m-0">
            @for (item of userMenuItems(); track $index) {
              @if (item.separator) {
                <li class="my-2">
                  <hr class="border-surface" />
                </li>
              } @else {
                <li>
                  <a 
                    [routerLink]="item.routerLink"
                    (click)="handleDrawerMenuItemClick(item)"
                    pRipple
                    class="flex items-center gap-3 p-4 cursor-pointer text-color hover:bg-emphasis rounded-lg transition-colors no-underline">
                    <i [class]="item.icon" class="text-lg"></i>
                    <span class="font-medium">{{ item.label }}</span>
                  </a>
                </li>
              }
            }
          </ul>
        </div>
      }
    </div>
    
    <!-- Guest User Actions (Not Authenticated) -->
    @if (!isAuthenticated()) {
      <div class="border-t border-surface pt-4 mt-auto">
        <div class="flex flex-col gap-2">
          <p-button 
            [icon]="'pi pi-sign-in'"
            severity="primary" 
            [label]="'AUTH.HEADER_LOGIN' | translate"
            (click)="navigateToLogin(); closeDrawer()"
            styleClass="w-full"
            [attr.aria-label]="'AUTH.ARIA_LOGIN' | translate">
          </p-button>
          
          <p-button 
            [icon]="'pi pi-user-plus'"
            severity="primary" 
            [outlined]="true"
            [label]="'AUTH.HEADER_REGISTER' | translate"
            (click)="navigateToRegister(); closeDrawer()"
            styleClass="w-full"
            [attr.aria-label]="'AUTH.ARIA_REGISTER' | translate">
          </p-button>
        </div>
      </div>
    }
    
  </div>
</p-drawer>
