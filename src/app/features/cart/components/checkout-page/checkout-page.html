<!-- Refactored Checkout Page - Clean Component Architecture -->
<div class="min-h-screen bg-gray-50 dark:bg-gray-900">

  <!-- Page Header -->
  <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
    <div class="container mx-auto px-4 py-6">
      <div class="flex items-center gap-3">
        <i class="pi pi-credit-card text-2xl text-primary-500" aria-hidden="true"></i>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
          Checkout
        </h1>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">

    <!-- Loading State -->
    @if (loading()) {
      <div class="max-w-4xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div>
            <p-card>
              <div class="space-y-4">
                <p-skeleton width="60%" height="1.5rem"></p-skeleton>
                <p-skeleton width="100%" height="3rem"></p-skeleton>
                <p-skeleton width="100%" height="3rem"></p-skeleton>
                <p-skeleton width="80%" height="3rem"></p-skeleton>
              </div>
            </p-card>
          </div>
          <div>
            <p-card>
              <div class="space-y-4">
                <p-skeleton width="50%" height="1.5rem"></p-skeleton>
                <p-skeleton width="100%" height="4rem"></p-skeleton>
                <p-skeleton width="100%" height="2rem"></p-skeleton>
              </div>
            </p-card>
          </div>
        </div>
      </div>
    }

    <!-- Error State -->
    @else if (error()) {
      <div class="max-w-md mx-auto text-center">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-8 shadow-sm border border-gray-200 dark:border-gray-700">
          <div class="w-16 h-16 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="pi pi-exclamation-triangle text-2xl text-red-600 dark:text-red-400" aria-hidden="true"></i>
          </div>
          <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Checkout Error</h2>
          <p-message
            severity="error"
            [text]="error()"
            class="mb-6 text-left">
          </p-message>
          <div class="flex gap-3 justify-center">
            <p-button
              label="Back to Cart"
              icon="pi pi-arrow-left"
              routerLink="/cart"
              severity="secondary">
            </p-button>
            <p-button
              label="Try Again"
              icon="pi pi-refresh"
              (click)="retryCheckout()"
              severity="primary">
            </p-button>
          </div>
        </div>
      </div>
    }

    <!-- Main Checkout Form - Refactored with Sub-components -->
    @else {
      <div class="max-w-6xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          
          <!-- Left Column: Form & Payment Components -->
          <div class="space-y-6">
            
            <!-- Shipping Address Form Component -->
            <app-checkout-form
              [isProcessing]="isProcessing()"
              (formValidChange)="onFormValidChange($event)"
              (formValueChange)="onFormValueChange($event)">
            </app-checkout-form>

            <!-- Payment Method Selector Component -->
            <app-payment-method-selector
              [selectedPaymentMethod]="paymentMethod()"
              [isDisabled]="isProcessing()"
              (paymentMethodChange)="onPaymentMethodChange($event)">
            </app-payment-method-selector>
          </div>

          <!-- Right Column: Order Summary Component -->
          <app-order-summary
            [cartItems]="cartItems()"
            [cartSummary]="cartSummary()"
            [isProcessing]="isProcessing()">
            
            <!-- Place Order Button (projected content) -->
            <div orderActions>
              <p-button 
                [label]="submitButtonLabel()"
                severity="primary"
                icon="pi pi-check"
                iconPos="right"
                [disabled]="!canSubmit()"
                [loading]="isProcessing()"
                (click)="onSubmit()"
                class="w-full"
                [attr.aria-label]="submitButtonLabel()">
              </p-button>
            </div>
          </app-order-summary>

        </div>
      </div>
    }

  </div>
</div>

<!-- Toast Container for Notifications -->
<p-toast position="top-right"></p-toast>
